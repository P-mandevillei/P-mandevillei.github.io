import{u as G,r as t,j as e,A as J,m as U,T as ee,c as H,a as se,C as P,L as X}from"./index-DqVyQ7DI.js";import{u as E,C as re}from"./chevron-down-BoDWhT1O.js";import{C as O}from"./Card-m-SWVjZ-.js";import{B as M,F as i}from"./Form-6c-IEpLl.js";import{T as ne}from"./TimeStamp-BcR1rfhg.js";import{R as z}from"./Row-MoJ4XHs1.js";import{C as S}from"./Col-B4HiK5qo.js";function ae(u,s,d,m,o){const j=typeof u=="number"&&u>=0,v=typeof s=="number"&&!isNaN(s),f=typeof d=="number"&&d>=0,y=typeof m=="number"&&m>=0,g=j+v+f+y;if(g===4)return{error:!0,msg:"noUnknown"};if(g<=2)return{error:!0,msg:"incomplete"};if(y)if(j)if(v){if(f)return{error:!0,msg:"invalid"};{if(m===0)return{error:!0,msg:"ssUnreachable"};let r=m/100;if(o!=="removeThenAdd")if(o==="removeWhileAdd")r=1-1/Math.pow(Math.E,r);else if(o==="addThenRemove")r=r/(1+r);else return{error:!0,msg:"invalid"};const c=7*s/30/r-7*s/30+u;return c>=0?{error:!1,unknown:"m",value:c.toFixed(2)}:{error:!0,msg:"ssUnreachable2"}}}else{let r=m/100;if(o!=="removeThenAdd")if(o==="removeWhileAdd")r=1-1/Math.pow(Math.E,r);else if(o==="addThenRemove")r=r/(1+r);else return{error:!0,msg:"invalid"};return r===100?{error:!1,unknown:"x",value:0}:{error:!1,unknown:"x",value:(30*(d-u)/7*r/(1-r)).toFixed(2)}}else{if(m===0)return{error:!0,msg:"ssUnreachable"};let r=m/100;if(o!=="removeThenAdd")if(o==="removeWhileAdd")r=1-1/Math.pow(Math.E,r);else if(o==="addThenRemove")r=r/(1+r);else return{error:!0,msg:"invalid"};const c=d+7*s/30-7*s/30/r;return c>=0?{error:!1,unknown:"s",value:c.toFixed(2)}:{error:!0,msg:"impossible"}}else{const r=30*d-30*u+7*s;if(r==0)return{error:!0,msg:"infinite"};const c=7*s/r;return c<0||c>=1?{error:!0,msg:"impossible"}:o==="removeThenAdd"?{error:!1,unknown:"y",value:(c*100).toFixed(2)}:o==="removeWhileAdd"?{error:!1,unknown:"y",value:(Math.log(1/(1-c))*100).toFixed(2)}:o==="addThenRemove"?{error:!1,unknown:"y",value:(c/(1-c)*100).toFixed(2)}:{error:!0,msg:"invalid"}}}function te(u){const{t:s}=G("waterChangeCalculator"),d=t.useId(),m=t.useId(),o=t.useId(),j=t.useId(),v=t.useId(),f=t.useId(),y=t.useRef(),g=t.useRef(),[r,c]=t.useState({error:!0,msg:s("incomplete")}),[a,n]=E(u.name,{substance:s("name"),unit:s("unit"),s:null,x:null,m:null,y:null});t.useEffect(()=>{C.current.value=a.s,b.current.value=a.x,N.current.value=a.m,k.current.value=a.y,R()},[]),t.useEffect(()=>{_()},[u.mode]);let h={...a};t.useEffect(()=>{h={...a}},[a]);const[T,A]=t.useState(!1),[x,W]=t.useState(!1),C=t.useRef(),b=t.useRef(),N=t.useRef(),k=t.useRef(),D={s:{name:s("s",{name:a.substance}),unit:a.unit,id:o,ref:C},x:{name:s("x",{name:a.substance}),unit:`${a.unit}/month`,id:j,ref:b},m:{name:s("m",{name:a.substance}),unit:a.unit,id:v,ref:N},y:{name:s("y"),unit:"%/week",id:f,ref:k}};function _(){var l,p,B,I;h.s=(l=C.current)==null?void 0:l.value,h.x=(p=b.current)==null?void 0:p.value,h.m=(B=N.current)==null?void 0:B.value,h.y=(I=k.current)==null?void 0:I.value,n(h),c(ae(parseFloat(C.current.value),parseFloat(b.current.value),parseFloat(N.current.value),parseFloat(k.current.value),u.mode))}const[w,F]=t.useState("");function R(){const l=parseFloat(C.current.value),p=parseFloat(b.current.value),B=parseFloat(N.current.value),I=parseFloat(k.current.value),Y=typeof l=="number"&&l>=0,$=typeof p=="number"&&!isNaN(p),q=typeof B=="number"&&B>=0,Z=typeof I=="number"&&I>=0;if(Y+$+q+Z<3){F("");return}if(Y)if($)if(q){F("y");return}else{F("m");return}else{F("x");return}else{F("s");return}}function Q(){L(!0)}function V(){L(!1),localStorage.removeItem(u.name);const l=u.blockNum.filter(p=>p!=u.name);u.setBlockNum(l)}const[K,L]=t.useState(!1);return e.jsxs(O,{className:"pad",style:{position:"relative"},children:[e.jsx(J,{children:K&&e.jsx(U.div,{className:"backdrop",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5}})}),e.jsx("span",{style:{position:"absolute",top:"1%",right:"2%"},className:"tertiaryColor tertiaryColorHover selectableHover",onClick:Q,children:"✘"}),e.jsx(ee,{className:"p-3",position:"middle-center",children:e.jsxs(H,{className:"secondaryColor tertiaryColorReverseBg",show:K,onClose:()=>{L(l=>!l)},children:[e.jsx(H.Header,{children:e.jsxs("strong",{className:"me-auto",children:[s("deleteThis")," "]})}),e.jsxs(H.Body,{style:{display:"flex",flexDirection:"column"},children:[s("sure"),e.jsx(M,{className:"secondaryColorBg secondaryColorBgHover largeBtnEffect",style:{margin:10},onClick:()=>L(!1),children:s("cancel")}),e.jsx("span",{className:"emphasis emphasisHover selectable",onClick:V,children:s("delete")})]})]})}),e.jsxs("p",{className:"center bold enlarge primaryColor",children:[e.jsx("span",{className:"selectable primaryColorHover",onClick:()=>{A(l=>!l),W(!1)},children:a.substance}),"  ",e.jsxs("span",{className:"selectable primaryColorHover",onClick:()=>{W(l=>!l),A(!1)},children:["(",a.unit,")"]}),T?e.jsxs(e.Fragment,{children:[e.jsx(i.Label,{htmlFor:d}),e.jsx(i.Control,{id:d,ref:y,placeholder:s("newName")}),e.jsx(M,{className:"cardBtn primaryColorBg primaryColorBgHover",onClick:l=>{var p;l==null||l.preventDefault(),h.substance=(p=y.current)==null?void 0:p.value,n(h)},children:s("updateName")})]}):e.jsx(e.Fragment,{}),x?e.jsxs(e.Fragment,{children:[e.jsx(i.Label,{htmlFor:m}),e.jsx(i.Control,{id:m,ref:g,placeholder:s("newUnit")}),e.jsx(M,{className:"cardBtn primaryColorBg primaryColorBgHover",onClick:l=>{var p;l==null||l.preventDefault(),h.unit=(p=g.current)==null?void 0:p.value,n(h)},children:s("updateUnit")})]}):e.jsx(e.Fragment,{})]}),e.jsxs(i.Label,{htmlFor:o,children:[s("s",{name:a.substance}),": ",a.unit?`(${a.unit})`:""]}),e.jsx(i.Control,{type:"number",id:o,ref:C,onChange:R,disabled:w==="s"}),e.jsxs(i.Label,{htmlFor:j,children:[s("x",{name:a.substance}),": (",a.unit,"/",s("month"),")"]}),e.jsx(i.Control,{type:"number",id:j,ref:b,onChange:R,disabled:w==="x"}),e.jsxs(i.Label,{htmlFor:v,children:[s("m",{name:a.substance}),": ",a.unit?`(${a.unit})`:""]}),e.jsx(i.Control,{type:"number",id:v,ref:N,onChange:R,disabled:w==="m"}),e.jsxs(i.Label,{htmlFor:f,children:[s("y")," (%/",s("week"),")"]}),e.jsx(i.Control,{type:"number",id:f,ref:k,onChange:R,disabled:w==="y"}),e.jsx("br",{}),e.jsx(M,{className:"primaryColorBg primaryColorBgHover largeBtnEffect",onClick:_,disabled:w==="",children:s("calc")}),r.error?e.jsx("p",{className:"emphasis",children:s(r.msg)}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"noMargin",children:[" ",D[r.unknown].name,": "]}),e.jsxs("p",{className:"center secondaryColor bold noMargin enlarge",children:[" ",r.value," ",D[r.unknown].unit?D[r.unknown].unit:""," "]})]})]})}function pe(){const[u,s]=E("mode","default"),[d,m]=E("blocks",[0]),o=t.useId(),j=t.useId(),v=t.useId(),[f,y]=t.useState(0),[g,r]=t.useState(30),[c,a]=t.useState(0);t.useEffect(()=>{if(isNaN(parseFloat(f))||isNaN(parseFloat(g))){a(0);return}a(f/g*30)},[f,g]);const{t:n}=G("waterChangeCalculator"),{lang:h}=se(),[T,A]=t.useState(!1);return e.jsxs("div",{style:{position:"relative",minHeight:"90vh"},className:"pad",children:[e.jsx(P,{fluid:!0,style:{width:"100%",marginBottom:"2em"},children:e.jsxs(z,{children:[e.jsxs(S,{xs:12,sm:6,lg:4,xl:3,children:[e.jsxs("p",{className:"primaryColor bold enlarge center noMargin",children:[n("title")," ",e.jsx("sup",{children:"*"})," "]}),e.jsxs("p",{className:"noMargin grey bold selectableHover hover",onClick:()=>{A(x=>!x)},children:[e.jsx(U.span,{animate:{rotate:T?0:-90},transition:{duration:.2},style:{display:"inline-block"},children:e.jsx(re,{size:18})}),n("ins")]}),e.jsx(J,{children:T&&e.jsxs(U.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.5},exit:{opacity:0,height:0},children:[e.jsxs("p",{className:"shrink primaryColor",children:[n("nav1"),e.jsx(X,{to:`/${h}/aquarium_calculator/water_change_level_adjustment`,children:n("nav2")})]}),e.jsxs("p",{className:"noMargin",children:[n("des1"),e.jsx("span",{className:"primaryColor bold",children:"+"}),n("des2")]}),e.jsxs("p",{className:"noMargin",children:[e.jsx("span",{className:"primaryColor bold",children:n("des3")}),n("des4"),e.jsx("span",{className:"primaryColor bold",children:n("des5")}),n("des6")]}),e.jsxs("p",{className:"noMargin",children:[n("des7"),e.jsx("span",{className:"primaryColor bold",children:n("des8")}),n("des9")]}),e.jsx("p",{className:"primaryColor bold",children:n("des10")}),e.jsx("p",{className:"grey shrink",style:{fontWeight:"normal"},children:n("unitReminder")})]})}),e.jsxs("p",{className:"center marginTopBottom",children:[e.jsx(i.Label,{htmlFor:o,className:"primaryColor bold",children:n("modeSelect")}),e.jsxs(i.Select,{id:o,value:u,onChange:x=>s(x.target.value),children:[e.jsxs("option",{value:"default",children:["-- ",n("default")," --"]}),e.jsx("option",{value:"removeThenAdd",children:n("mode1")}),e.jsx("option",{value:"removeWhileAdd",children:n("mode2")}),e.jsx("option",{value:"addThenRemove",children:n("mode3")})]})]}),e.jsxs(O,{className:"center marginTopBottom",style:{padding:"0.3em"},children:[e.jsxs("p",{className:"primaryColor noMargin bold",children:[n("convert")," "]}),e.jsxs("p",{className:"shrink noMargin",style:{color:"grey"},children:[" ",n("convertDes")," "]}),e.jsx(P,{className:"noPad",children:e.jsxs(z,{children:[e.jsxs(S,{xs:6,style:{paddingRight:0},children:[e.jsx(i.Label,{htmlFor:j,children:n("level")}),e.jsx(i.Control,{type:"number",id:j,value:f,onChange:x=>{y(x.target.value)}})]}),e.jsxs(S,{xs:6,style:{paddingLeft:0},children:[e.jsxs(i.Label,{htmlFor:v,children:[n("days")," "]}),e.jsx(i.Control,{type:"number",id:v,value:g,onChange:x=>{r(x.target.value)}})]})]})}),e.jsxs("p",{className:"secondaryColor bold",children:[f," (",n("unit1",{number:g}),") = ",c," (",n("unit2"),") ",e.jsx("br",{})]})]}),e.jsxs("p",{className:"shrink grey",children:[e.jsx("sup",{children:"*"})," ",n("reference")," ",e.jsxs("a",{href:"https://mp.weixin.qq.com/s/1Hr0FKTt7gGaDrpPCIKldw",target:"_blank",children:[" ",n("refTitle")," "]})]})]}),d.map(x=>e.jsx(S,{xs:12,sm:6,lg:4,xl:3,style:{padding:0},children:e.jsx(te,{mode:u,name:x,blockNum:d,setBlockNum:m})},x)),e.jsx(S,{xs:12,sm:6,lg:4,xl:3,className:"pad",style:{height:450,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(M,{className:"round primaryColorBg primaryColorBgHover",style:{aspectRatio:"1/1",margin:"auto"},onClick:()=>{d.length>0?m([...d,d[d.length-1]+1]):m([0])},children:"+"})})]})}),e.jsxs("div",{style:{position:"absolute",bottom:0},children:[e.jsx(X,{to:`/${h}/aquarium_calculator`,children:n("back")}),e.jsx(ne,{name:"waterChangeCalculator"})]})]})}export{pe as default};
